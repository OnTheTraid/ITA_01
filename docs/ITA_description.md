# ITA 
# Проект разработки интеллектуального торгового агента c ИИ

## Цель и ключевые принципы

## 1.1 Миссия

Создать интеллектуального торгового агента (ИТА) — надёжный, понятный и модульный инструмент, который помогает проп-трейдеру принимать качественные решения, автоматизирует сбор и анализ рыночных данных, обеспечивает репроизводимые бэктесты и минимизирует влияние эмоций на процесс трейдинга. ИТА не заменяет трейдера, не предназначен для автоматической торговли, он усиливает профессионализм анализа графика — превращает субъективную интуицию в объективные, проверяемые гипотезы. 
ИТА обеспечивает трейдера бектестами, сигналами в лайв торговле и обучается на статистике отработки анализа.

## 1.2 Общий функционал агента

1. **Масштабируемый сбор данных**
ИТА собирает и хранит огромные объёмы исторических и живых данных (свечи, объёмы, метаданные, скриншоты, ручная разметка).
2. **Объективный и воспроизводимый анализ графика**
Правила и критерии сигналов формализованы в в сетапах. В результате одно и то же правило на тех же данных даёт одинаковый результат — это снимает спорные моменты и даёт основу для научного подхода.
3. **Быстрые, системные бэктесты**
ИТА с помощью GPT модуля позволяет быстро прогонять стратегии/сетапы по истории, получать метрики (winrate, avg RR, drawdown, expectancy. Так же простые сетапы на несколько не сложных правил агент должен выполнять автономно без помощи LLM, посредством внутреннего кода.
4. **Помощь в принятии торговых решений (advice & prioritization)**
ИТА ранжирует сигналы по качеству/вероятности, указывает сильные и слабые стороны конкретного сигнала и предлагает возможные варианты управления риском.
5. **Накопление и переиспользование знаний**
Всё, что сработало/не сработало, сохраняется и становится входом для улучшения правил и ML-моделей. Это обеспечивает экспоненциальное улучшение качества анализа со временем.
6. **Экономия времени и операционной эффективности**
Автоматизация рутинных задач (аннотации, скриншоты, отчёты, выгрузки в Notion/Telegram) даёт трейдеру время на стратегию и психологию, а не на «ручную» работу.
7. Обработка теоретических баз данных. 
ИТА сохранят файлы с теорией, которые предоставляет пользователь, переводит их в векторную библиотеку и использует эту теорию как приоритет над данными в интернете для запросов пользователя по поиску информации.

Интерфейс и workflow строятся под человека: понятные отчёты, простые конфиги, и инструкции.

## 1.3 Конкретные функции агента

- **Сбор данных:** импорт свечных данных (CSV/экспорт), периодический парсинг графиков, хранение скриншотов и метаданных.
- **Формализация правил:** хранение чётких определений сетапов (имбалансы, фракталы, уровни сессий, снятие ликвидности и т.д.) в машиночитаемом виде.
- **Детектор сигналов:**  который находит сигналы по формализованным правилам.
- **Визуализация:** автоматическая аннотация графиков (для проверки и отчёта) визуал скринов в Dash/Plotly
- **Бэктестер:** симуляция сделок по истории с отчётностью (WinCount, WinRate, Total Profit, Avg RR, Max Drawdown и т.д.). Данные графика с МТ5, визуал Dash/Plotly
- **Реал-тайм мониторинг и уведомления:** выдача сигналов в Telegram/Notion с краткими картинками и комментариями.
- **Аналитика и отчёты:** агрегированные показатели по неделям/месяцам/стратегиям, бенчмарки.
- Важная функция - **Обучаемость Агента** на основе бектестов и статистики, а так же теоретических данных, предоставленных пользователем. Способность проверки теории на бектестах и формирования практической проверенной базы знаний для использования в дальнейшей работе. Непрерывный процесс обучения со сбором статистики, винрейта отработки сетапов и логик. Выдача рекомендаций на основе этой статистики.
- **ML/прогнозирование :** по мере накопления данных — модель, дающая вероятность успешности сигнала и объяснимость.
- Система аккумулирует данные, на основе которых можно создать ML-модель с AUC и показателями, превосходящими «случай», что подтверждает обучаемость и ценность ИТА.
- Возможность работы с несколькими разработчиками отдельно локально, делать бектесты, но сохранить общую базу знаний для обучаемости Агента, например на гугл диске.
- **Управление сетапами (Setup Manager):** хранение, редактирование и версионирование правил; автоматическое связывание результатов анализа и статистики с конкретной версией сетапа.
- При работе в реальном времени ИТА предоставляет **распознаваемые и ранжированные сигналы** и сопровождает их понятными человеку метриками и пояснениями. Уведомление приходит в Telegram не позднее 30 секунд после закрытия соответствующей свечи
- Для бэктестера: корректная генерация отчёта в Ноушен с WinRate, Avg RR и Drawdown для заданного периода (проверка по случайной выборке входов/выходов).

**Не цель:** полностью автономный алгоритм, который торгует вместо трейдера без человеческой проверки.

## 1.4 Примеры пользовательских сценариев (user stories)

- Как трейдер на Проп-фирмах, я хочу загрузить 20 размеченных скриншотов торговых сетапов и получить автоматическую проверку детектора, чтобы убедиться, что правило корректно детектируется.
- Как трейдер, я хочу прогнать правило сетапа по году истории и получить CSV с WinRate и Drawdown, чтобы понять реальную эффективность.
- Как трейдер, я хочу получать в Telegram компактное уведомление с картинкой и коротким комментарием, возможностью визуализации похожих паттернов на истории, чтобы быстро решать — входит ли сигнал в мой план.
- Как трейдер-непрограммист, я хочу редактировать параметры правила через простую Notion-таблицу или YAML, чтобы не писать код.

---

## 1. Общие технологические принципы

## Краткая архитектурная идея (one-liner)

**Prefect** — orchestration и Python-ядро (все данные, Market Tools, Setup Manager, Backtester, Dash/Streamlit визуализация, Storage, Scheduler).

**LangChain** — LLM-инструментарий (Prompt Manager, Memory, Retriever, fine-tune / evaluation).

**Streamlit** — пользовательский UI / админ-панель / визуализация (использовать библиотеку ReactFlow).

**ChromaDB** — векторная память (локально / optional cloud).

Файловая шина (`/exchange`) — для передачи PNG/JSON между подсистемами (Dash → LLM → аннотированные PNG → storage).

---

## Общие технологические рекомендации

- Язык: **Python 3.11.x**.
- Оркестратор: **Prefect 2.19.x** (локально, Orion UI).
- LLM-инструменты: **LangChain (latest stable)** + `openai` (для OpenAI/GPT), `llama-cpp-python`/Ollama/other if local models later.
- Vector DB: **ChromaDB** (локальная файловая установка).
- Визуал: **Streamlit** ( ReactFlow уже для рабочей версии) + **Plotly** / Dash (Plotly для графиков).
- MT5 connector: `MetaTrader5` (если используется локальный MT5) или экспорт CSV. Бектесты выполняются на архивных данных, загружаются только по мере надобности новых данных. Для лайв торговли данные графика перезаписуются во временной папке.
- Storage: локальные папки + опция S3 / Google Drive sync (через rclone) — но сначала локально.
- Notion: `notion-client` (официальный/неофициальный).
- Telegram: `python-telegram-bot` (v13/20).
- Логи и мониторинг: Prefect + `loguru`.
- Dev: VSCode, venv, git (репозиторий).

---

# Высокоуровневые потоки пример (2 сценария)

A. **Backtest flow** (user request → Prefect):

`Request → Setup Manager → Core Data & IO (CSV/MT5) → Market Tools → Backtester Runner → Visualizer → Save JSON+PNG → LangChain Analysis (optional) → Store results → Notion + Report`.

B. **Live flow (alerts/advice)**:

`Scheduler or Manual Start → Setup Manager (active rules) →  MT5 Live Loader (1m polling) → Data Processor / Session Engine → Market Tools detectors → Scoring / ML probability (Learning Module) → Decision to notify → Build snapshot PNGs via Visualizer → send to LangChain for final LLM comment → Telegram notify + write journal in Notion`.

---