# üìò ITA_TZ_02_CoreData.md  
**–ú–æ–¥—É–ª—å:** 02_CoreData (Core Data & IO)  
**–ü—Ä–æ–µ–∫—Ç:** Intelligent Trading Agent (ITA)  
**–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ (Module-Level Specification)  
**–î–∞—Ç–∞:** 2025-11-06  
**–í–µ—Ä—Å–∏—è:** v1.1  
**–ê–≤—Ç–æ—Ä:** Dreyk (–∏–¥–µ–π–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä), GPT-5 (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä)

---

## 1. üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è

–ú–æ–¥—É–ª—å **Core Data & IO** —è–≤–ª—è–µ—Ç—Å—è —è–¥—Ä–æ–º —Å–∏—Å—Ç–µ–º—ã ITA, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–º –≤–µ—Å—å —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Å —Ä—ã–Ω–æ—á–Ω—ã–º–∏ –∫–æ—Ç–∏—Ä–æ–≤–∫–∞–º–∏ ‚Äî –æ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–æ –∏—Ö –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥—Ä—É–≥–∏–º –º–æ–¥—É–ª—è–º —Å–∏—Å—Ç–µ–º—ã.  

CoreData –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
- –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º (MT5 API, CSV –∞—Ä—Ö–∏–≤—ã, —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ API –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏);
- –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –∏ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö;
- –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (`pandas.DataFrame`, JSON);
- —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–ª—è Live-—Ä–µ–∂–∏–º–∞;
- –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é;
- –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª—è–º `03_DataStorage`, `04_MarketTools`, `05_SetupManager`, `06_BacktestManager` –∏ `08_GPT_VisionFlow`.

–¶–µ–ª—å –º–æ–¥—É–ª—è ‚Äî **–æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–º –¥–∞–Ω–Ω—ã–º** –¥–ª—è –≤—Å–µ—Ö —á–∞—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞ ITA –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.

---

## 2. üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–¥–º–æ–¥—É–ª–µ–π

| ‚Ññ | –ü–æ–¥–º–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ |
|--|------------|-------------|--------------|
| **2.2.1** | **Data Ingest (MT5 Connector)** | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MT5 API, –ø–æ–ª—É—á–µ–Ω–∏–µ OHLCV –¥–∞–Ω–Ω—ã—Ö –∑–∞ –∑–∞–¥–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥. | `mt5_connector.py` |
| **2.2.2** | **CSV/Archive Loader** | –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö CSV –∏–ª–∏ Parquet –∞—Ä—Ö–∏–≤–æ–≤ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å MT5. | `archive_loader.py` |
| **2.2.3** | **Data Processor** | –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è, —Ä–µ—Å–µ–º–ø–ª–∏–Ω–≥, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —à—É–º–æ–≤. | `data_processor.py` |
| **2.2.4** | **Session Engine** | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞–º–æ–∫ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π (Asia, Frankfurt, London, NY), –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π Daily/Weekly Open, NY Midnight. –§–æ—Ä–º–∏—Ä—É–µ—Ç JSON `{session_name, start, end, high, low, timezone}`. | `session_engine.py` |
| **2.2.4.1** | **Data Refresh Scheduler** | –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (live refresh). –ó–∞–ø—É—Å–∫–∞–µ—Ç `MT5 Loader` —Å —á–∞—Å—Ç–æ—Ç–æ–π, –∑–∞–¥–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (1 –º–∏–Ω / 1 –Ω–µ–¥–µ–ª—è). | `data_refresh_scheduler.py` |
| **2.2.5** | **MT5 Data Cache** | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: in-memory buffer (ring buffer –¥–ª—è N –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–≤–µ—á–µ–π) + disk cache (Parquet). –†–µ–∞–ª–∏–∑—É–µ—Ç `IncrementalUpdater`. | `mt5_cache.py` |
| **2.2.6** | **Data Validator** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤, –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏. | `data_validator.py` |
| **2.2.7** | **IO Formatter** | –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ DF/JSON/Parquet. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏. | `io_formatter.py` |
| **2.2.8** | **Data Engine** | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä CoreData: —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∑–∞–≥—Ä—É–∑–∫–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –≤—ã–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö. | `data_engine.py` |

---

(–¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–¥–º–æ–¥—É–ª–∏: 2.2.7 IO Formatter –∏ —É—Ç–æ—á–Ω—ë–Ω —Å–æ—Å—Ç–∞–≤ 2.2.4‚Äì2.2.5 —Å–æ–≥–ª–∞—Å–Ω–æ ITA_modules_v1.1.md –∏ Data Flows)

3. üß≠ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ

–ú–æ–¥—É–ª—å CoreData —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤ —Å–ª–æ–µ Data Layer –º–µ–∂–¥—É SetupManager –∏ MarketTools.

UserRequest ‚Üí SetupManager ‚Üí CoreData ‚Üí MarketTools ‚Üí Backtester ‚Üí Visualization ‚Üí VisionFlow


CoreData –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç API –¥–ª—è –≤—Å–µ—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö (–≤ —Ç–æ–º —á–∏—Å–ª–µ VisionFlow) –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Prefect orchestration.

4. ‚öôÔ∏è –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
Live —Ä–µ–∂–∏–º:
```
SetupManager (–∑–∞–ø—Ä–æ—Å)
    ‚Üì
CoreData.DataRefreshScheduler ‚Üí MT5 Loader
    ‚Üì
Data Processor ‚Üí Validator ‚Üí Cache (InMemory + Disk)
    ‚Üì
IO Formatter ‚Üí MarketTools / Visualization

Backtest —Ä–µ–∂–∏–º:
SetupManager (–∑–∞–ø—Ä–æ—Å)
    ‚Üì
CSV/Archive Loader ‚Üí Processor ‚Üí Validator
    ‚Üì
Session Engine ‚Üí IO Formatter
    ‚Üì
DataStorage.archive() ‚Üí Backtester
```

–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–µ–∂–∏–º–∞–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ Live –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é, –∞ Backtest –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞—Ä—Ö–∏–≤—ã –±–µ–∑ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ MT5.

5. üîå –í—Ö–æ–¥–Ω—ã–µ –∏ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–í—Ö–æ–¥ (SetupManager ‚Üí CoreData):
{
  "symbol": "GER40",
  "timeframe": "M5",
  "start_date": "2024-03-01",
  "end_date": "2024-03-10",
  "mode": "live" | "backtest"
}

–í—ã—Ö–æ–¥:

DataFrame (OHLCV) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç;

JSON Summary:

{
  "symbol": "GER40",
  "timeframe": "M5",
  "records": 18000,
  "source": "MT5",
  "sessions": ["Asia", "London", "NY"],
  "status": "validated"
}


Parquet ‚Äî –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ DataStorage;

Temp JSON ‚Äî –¥–ª—è VisionFlow –∏ MarketTools.

–∫–æ–Ω—Ü–µ–ø—Ü–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è
–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö	–ò—Å—Ç–æ—á–Ω–∏–∫	–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ	–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
üóÉÔ∏è –ê—Ä—Ö–∏–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö	MetaQuotes-Demo	–ë—ç–∫—Ç–µ—Å—Ç—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –æ–±—É—á–µ–Ω–∏–µ	–°—Ç–∞–±–∏–ª—å–Ω—ã–π, –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞
‚ö° Live-–¥–∞–Ω–Ω—ã–µ	EquityEdge-Trade (–∏–ª–∏ –¥—Ä—É–≥–æ–π –ø—Ä–æ–ø)	–¢–µ–∫—É—â–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è, live-–∞–Ω–∞–ª–∏–∑	–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É / –º–∏–Ω—É—Ç—É, –Ω–µ –∞—Ä—Ö–∏–≤–∏—Ä—É—é—Ç—Å—è
üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ (–Ω–æ–≤–∞—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)
data/
‚îú‚îÄ‚îÄ archive/                   # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∞—Ä—Ö–∏–≤ –¥–ª—è –±—ç–∫—Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ raw/
‚îÇ       ‚îî‚îÄ‚îÄ EURUSD/
‚îÇ           ‚îî‚îÄ‚îÄ M15/
‚îÇ               ‚îú‚îÄ‚îÄ 2020_01_01_2020_02_01.parquet
‚îÇ               ‚îú‚îÄ‚îÄ 2020_02_01_2020_03_01.parquet
‚îÇ
‚îî‚îÄ‚îÄ cache/                     # Live-–¥–∞–Ω–Ω—ã–µ (–æ—á–∏—â–∞—é—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ)
    ‚îî‚îÄ‚îÄ EURUSD_M15_live.parquet


‚úÖ –ê—Ä—Ö–∏–≤ (MetaQuotes) ‚Äî –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π, –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.
‚úÖ Cache (Equity) ‚Äî —Ç–æ–ª—å–∫–æ —Å–≤–µ–∂–∏–µ –∫–æ—Ç–∏—Ä–æ–≤–∫–∏, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è Live-—Ç—Ä–µ–π–¥–∞.

üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–ø–∫–∏

–†–µ–∞–ª–∏–∑—É–µ–º –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫—É:

–ª–∏–±–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ ITA,

–ª–∏–±–æ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é Prefect (–Ω–∞–ø—Ä–∏–º–µ—Ä, Every 1 hour).

6. üß† –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø–æ–¥–º–æ–¥—É–ª–µ–π
2.2.1 Data Ingest (MT5 Connector)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç MetaTrader5 Python API.

–ú–µ—Ç–æ–¥—ã:

connect(), get_ohlcv(symbol, timeframe, start, end)

–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç DataFrame —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ ['time', 'open', 'high', 'low', 'close', 'volume'].

–ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –∏ –≤—ã–∑—ã–≤–∞–µ—Ç CSV/Archive Loader.

2.2.2 CSV/Archive Loader

–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –∞—Ä—Ö–∏–≤—ã /data/archive/{symbol}/{tf}/.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã .csv, .parquet.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ fallback –ø—Ä–∏ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ –∏–ª–∏ –≤ Backtest.

2.2.3 Data Processor

–û—á–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∏.

–ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤—Ä–µ–º—è –≤ UTC.

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç time index —Å Broker Server Time.

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Session Engine –∏ Validator.

2.2.4 Session Engine

–†–∞—Å—á—ë—Ç —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π (Asia, Frankfurt, London, NY).

–†–∞—Å—á—ë—Ç —É—Ä–æ–≤–Ω–µ–π:

Daily Open / Weekly Open

NY Midnight Level

–§–æ—Ä–º–∏—Ä—É–µ—Ç JSON:

{ "session_name": "London", "start": "...", "end": "...", "high": ..., "low": ..., "timezone": "UTC+2" }


–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Market Tools, Context Visualizer, Dash Visualizer.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É –ø–æ DST (Daylight Saving Time).

–†–µ–∞–ª–∏–∑—É–µ—Ç –º–æ–¥—É–ª—å session_engine.py.

2.2.4.1 Data Refresh Scheduler

Prefect task, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

–î–ª—è live-—Ä–µ–∂–∏–º–∞: Every 1 minute; –¥–ª—è backtest ‚Äî —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫.

–ú–µ—Ç–æ–¥—ã:

schedule_refresh(interval),

trigger_loader().

–ü—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç Data Ingest.

2.2.5 MT5 Data Cache

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —É—Å–∫–æ—Ä–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ MT5.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫—ç—à–∞:

InMemoryBuffer ‚Äî collections.deque –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–≤–µ—á–µ–π;

OnDiskCache ‚Äî .parquet —Ñ–∞–π–ª—ã —Å TTL –∏ snapshot;

IncrementalUpdater ‚Äî —Ñ—É–Ω–∫—Ü–∏—è get_new_from_mt5(last_ts).

–ü–æ–≤–µ–¥–µ–Ω–∏–µ:

Live: –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –±–∞—Ä—ã (append ‚Üí persist async);

Backtest: —á–∏—Ç–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã;

–ö–ª—é—á –∫–µ—à–∞: {symbol}_{timeframe}_{start}_{end};

Storage path: /data/cache/{symbol}_{tf}_{start}_{end}.parquet.

2.2.6 Data Validator

–ü—Ä–æ–≤–µ—Ä–∫–∞:

–ø—Ä–æ–ø—É—Å–∫–æ–≤;

–¥—É–±–ª–∏–∫–∞—Ç–æ–≤;

–ø–µ—Ä–µ–ø—É—Ç–∞–Ω–Ω—ã—Ö timestamp;

NaN –≤ OHLC.

–ú–µ—Ç–æ–¥—ã:

check_integrity(df),

repair(df) (–ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ ‚Äî –ø–µ—Ä–µ–∑–∞–ø–æ–ª–Ω—è–µ—Ç –∏–ª–∏ –ª–æ–≥–∏—Ä—É–µ—Ç).

–í—ã–≤–æ–¥–∏—Ç –æ—Ç—á—ë—Ç JSON –æ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

2.2.7 IO Formatter

–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä—É–µ—Ç –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π.

–ú–µ—Ç–æ–¥—ã:

to_json(df), to_parquet(df), to_df(json).

–£–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –∂—É—Ä–Ω–∞–ª–æ–≤ –∏ –æ—Ç—á—ë—Ç–æ–≤.

2.2.8 Data Engine

–£–ø—Ä–∞–≤–ª—è—é—â–∏–π —Å–ª–æ–π CoreData.

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç:

Data Ingest / Loader ‚Üí Processor ‚Üí Validator ‚Üí Cache ‚Üí Formatter


–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

–∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Prefect Tasks;

–ø–µ—Ä–µ–¥–∞—á—É –ª–æ–≥–æ–≤ –≤ 11_Orchestration;

–æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –¥–ª—è SetupManager.

–ú–µ—Ç–æ–¥—ã:

run(mode, params),

get_status(),

export_results().

7. üîó –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏
–ú–æ–¥—É–ª—å	–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ	–û–ø–∏—Å–∞–Ω–∏–µ
03_DataStorage	Out	–ü–µ—Ä–µ–¥–∞—á–∞ –∞—Ä—Ö–∏–≤–æ–≤ (Parquet, JSON).
04_MarketTools	Out	–î–∞–Ω–Ω—ã–µ OHLCV + Session JSON –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤.
05_SetupManager	In	–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –∏ —Å–∏–≥–Ω–∞–ª—ã –∑–∞–ø—É—Å–∫–∞.
06_BacktestManager	Out	–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤.
07_Visualization	Out	DataFrame –∏ Session JSON –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤.
08_GPT_VisionFlow	Out	–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON/DF –¥–ª—è LLM –∞–Ω–∞–ª–∏–∑–∞.
11_Orchestration	Two-way	–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Prefect Flows, –ª–æ–≥–∞–º–∏ –∏ —Ç–∞—Å–∫–∞–º–∏.
8. üßæ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞

–í—Å–µ –ø–æ–¥–º–æ–¥—É–ª–∏ –∏–º–µ—é—Ç –µ–¥–∏–Ω—ã–π –ª–æ–≥–≥–µ—Ä logger_coredata.

–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤: JSON Lines (.log ‚Üí /logs/coredata/).

–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤: INFO / WARNING / ERROR.

–ö–∞–∂–¥—ã–π Prefect Task –ª–æ–≥–∏—Ä—É–µ—Ç:

{
  "task": "DataProcessor",
  "status": "success",
  "duration": "0.67s",
  "records": 5000
}


–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:

100% —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è timestamp;

<0.1% NaN –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏;

99.9% —É—Å–ø–µ—à–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π MT5 –∑–∞ –Ω–µ–¥–µ–ª—é.

9. ‚ö†Ô∏è –û—à–∏–±–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
–û—à–∏–±–∫–∞	–ü—Ä–∏—á–∏–Ω–∞	–û–±—Ä–∞–±–æ—Ç–∫–∞
ConnectionError	MT5 API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω	fallback ‚Üí CSV Loader
EmptyDataError	–ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ –≤–µ—Ä–Ω—É–ª –¥–∞–Ω–Ω—ã–µ	–ª–æ–≥ + –≤–æ–∑–≤—Ä–∞—Ç None
ValidationError	–û—à–∏–±–∫–∏ DataFrame	–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
CacheMissError	–ù–µ—Ç –Ω—É–∂–Ω–æ–≥–æ –∫—ç—à–∞	–∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ MT5 Loader
IncrementalError	–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö	–ª–æ–≥, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ Scheduler
FileIOError	–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏–∏	–ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
10. üß© –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–§–∞–π–ª config.yaml –∏–∑ 12_Config_Security:
```
coredata:
  mt5:
    host: localhost
    port: 1950
  cache:
    ttl_minutes: 120
    max_memory_records: 500
  refresh:
    live_interval: 1m
    backtest_manual: true
  paths:
    archive: data/archive/
    cache: data/cache/
    temp: data/temp/
```

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏:

MetaTrader5, pandas, numpy, pyarrow, prefect, loguru, schedule.

11. üßÆ ASCII-—Å—Ö–µ–º–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã CoreData
```
                    +----------------------+
                    |  SetupManager Input  |
                    +----------+-----------+
                               |
                    v (params: symbol, tf, mode)
          +---------------------+
          |  Data Engine (2.2.8)|
          +----------+----------+
                     |
          +----------v-----------+
          |  MT5 Connector (2.2.1)|
          +----------+------------+
                     | fallback
          +----------v-----------+
          |  CSV Loader (2.2.2)  |
          +----------+-----------+
                     |
          +----------v-----------+
          | Data Processor (2.2.3)|
          +----------+------------+
                     |
          +----------v-----------+
          | Session Engine (2.2.4)|
          +----------+------------+
                     |
          +----------v-----------+
          | Data Validator (2.2.6)|
          +----------+------------+
                     |
          +----------v-----------+
          | MT5 Cache (2.2.5)     |
          +----------+------------+
                     |
          +----------v-----------+
          | IO Formatter (2.2.7)  |
          +----------+------------+
                     |
          +----------v-----------+
          | DataStorage / MarketTools / VisionFlow |
          +----------------------------------------+
```
12. ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
–ú–µ—Ç—Ä–∏–∫–∞	–¶–µ–ª—å	–ü—Ä–æ–≤–µ—Ä–∫–∞
–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ 10 000 –±–∞—Ä–æ–≤	‚â§ 1.5 —Å–µ–∫	Prefect logs
–ö–æ–ª-–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ Live	‚â• 99% —É—Å–ø–µ—à–Ω—ã—Ö	Scheduler logs
–ü—Ä–æ–ø—É—Å–∫–∏ –¥–∞–Ω–Ω—ã—Ö	‚â§ 0.05%	Validator report
–ü–∞–º—è—Ç—å –∫—ç—à–∞	‚â§ 200 –ú–ë	ring buffer monitor
–ê—Ä—Ö–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ	‚â• 1 –≥–æ–¥	DataStorage policy
13. üß† –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ò–∑–æ–ª—è—Ü–∏—è –ø–æ–¥–º–æ–¥—É–ª–µ–π: –∫–∞–∂–¥—ã–π .py –Ω–µ–∑–∞–≤–∏—Å–∏–º –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º.

–ú–∏–Ω–∏–º—É–º —Å–≤—è–∑–µ–π: –≤—Å–µ –æ–±–º–µ–Ω—ã —á–µ—Ä–µ–∑ DataFrame/JSON.

Prefect –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è orchestration, –Ω–æ –ª–æ–≥–∏–∫–∞ ‚Äî –º–æ–¥—É–ª—å–Ω–∞—è.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø–æ–∑–≤–æ–ª—è—Ç—å –∑–∞–ø—É—Å–∫ Live –∏ Backtest –ø–æ—Ç–æ–∫–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

–í—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–π (deterministic output).

14. üìÑ –í—ã—Ö–æ–¥–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
–ê—Ä—Ç–µ—Ñ–∞–∫—Ç	–§–æ—Ä–º–∞—Ç	–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
coredata_status.json	JSON	–û—Ç—á—ë—Ç –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
coredata_cache.parquet	Parquet	–ö—ç—à
coredata_sessions.json	JSON	–°–µ—Å—Å–∏–∏ –¥–ª—è MarketTools
coredata_log.jsonl	JSONL	–õ–æ–≥–∏ –∑–∞–¥–∞—á
coredata_summary.json	JSON	–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏
‚úÖ –ò—Ç–æ–≥

–ú–æ–¥—É–ª—å Core Data & IO (02_CoreData) ‚Äî —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ—Ç–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ ITA.
–û–Ω –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –∏ –≤—ã—Å–æ–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —ç—Ç–æ–º—É –¢–ó –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:

–æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ Live –∏ Backtest —Ä–µ–∂–∏–º–æ–≤;

—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–æ–Ω –∏ —Å–µ—Å—Å–∏–π;

–Ω—É–ª–µ–≤–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö;

—É—Å—Ç–æ–π—á–∏–≤—É—é —Ä–∞–±–æ—Ç—É Prefect Flows;

–ø–æ–ª–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å MarketTools, SetupManager, Backtester –∏ VisionFlow.

üìò –ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞
