# üìò ITA_TZ_02.2.2_CSV_Archive_Loader_v1.1

**–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ (–¢–ó –Ω–∞ –ø–æ–¥–º–æ–¥—É–ª—å)  
**–ú–æ–¥—É–ª—å:** 02_CoreData  
**–ü–æ–¥–º–æ–¥—É–ª—å:** 2.2.2 CSV / Archive Loader  
**–í–µ—Ä—Å–∏—è:** v1.1  
**–î–∞—Ç–∞:** 2025-11-11  
**–ê–≤—Ç–æ—Ä:** Dreyk (–∏–¥–µ–π–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä), GPT-5 (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä)

---

## 1. üéØ –¶–µ–ª—å –ø–æ–¥–º–æ–¥—É–ª—è

–û–±–µ—Å–ø–µ—á–∏—Ç—å **–Ω–∞–¥—ë–∂–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É —Ä—ã–Ω–æ—á–Ω—ã—Ö –∫–æ—Ç–∏—Ä–æ–≤–æ–∫** (OHLCV –∏ tick –¥–∞–Ω–Ω—ã—Ö) –∏–∑ **–ª–æ–∫–∞–ª—å–Ω—ã—Ö CSV –∏ Parquet –∞—Ä—Ö–∏–≤–æ–≤**,  
–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–∞–∫:
- –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ *Backtest*-—Ä–µ–∂–∏–º–µ;
- fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MT5 API –≤ *Live*-—Ä–µ–∂–∏–º–µ;
- –∏—Å—Ç–æ—á–Ω–∏–∫ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π (`Data Processor`, `Validator`, `Session Engine`).

–ü–æ–¥–º–æ–¥—É–ª—å —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —Å–∏—Å—Ç–µ–º—ã **CoreData & IO** –∏ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å `MT5 Connector`.

---

## 2. üß© –ü–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

**CSV/Archive Loader** ‚Äî —ç—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å fallback –∏ offline-–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:

```
             +--------------------+
             | SetupManager Input  |
             +----------+----------+
                        |
                        v
               +--------------------+
               | Data Engine (2.2.8)|
               +----------+----------+
                          |
            +-------------v--------------+
            | MT5 Connector (2.2.1)      |
            +-------------+--------------+
                          | fallback
            +-------------v--------------+
            | CSV / Archive Loader (2.2.2)|
            +-------------+--------------+
                          |
               ‚Üí Data Processor (2.2.3)
```

**–†–æ–ª—å:**  
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç `SetupManager` —á–µ—Ä–µ–∑ `CoreData.DataEngine`;  
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω—É–∂–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –∏–∑ `/data/archive/raw/{symbol}/{tf}/`;  
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö;  
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π `pandas.DataFrame` –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

---

## 3. ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö `.csv` –∏–ª–∏ `.parquet`.  
2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ —Ñ–∞–π–ª–æ–≤ –ø–æ –¥–∞—Ç–µ (`start_date`, `end_date`).  
3. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ –æ–¥–∏–Ω DataFrame —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏.  
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö:  
   - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è `["time", "open", "high", "low", "close", "volume"]`;  
   - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫ UTC;  
   - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ NaN –∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.  
5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `Data Integrity Checker`.  
6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ `/logs/coredata/archive_loader.log`.  
7. –í–æ–∑–≤—Ä–∞—Ç JSON –æ—Ç—á—ë—Ç–∞ –≤ Prefect Flow —Å —É–∫–∞–∑–∞–Ω–∏–µ–º:
   - –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞–Ω–Ω—ã—Ö,  
   - –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫,  
   - –ø—É—Ç–∏ –∫ –∞—Ä—Ö–∏–≤—É,  
   - —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏.  
8. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MT5 Connector.  
9. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –≤ `/data/cache/` –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

---

## 4. üì• –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 4.1 SetupContext JSON
–ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –æ—Ç `SetupManager` / `DataEngine`:

```json
{
  "symbol": "GER40",
  "timeframe": "M15",
  "date_start": "2025-04-01",
  "date_end": "2025-05-31",
  "mode": "BACKTEST",
  "prefect_context_id": "run-002"
}
```

### 4.2 ENV-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—É—Ç–µ–π:
```
ITA_DATA_PATH=/data
ITA_ARCHIVE_PATH=/data/archive
ITA_CACHE_PATH=/data/cache
```

### 4.3 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.yaml)
```yaml
coredata:
  archive_loader:
    preferred_format: parquet
    allow_csv: true
    timezone: UTC
    cache_enabled: true
```

---

## 5. üì§ –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

1. **DataFrame OHLCV**  
   –°—Ç—Ä—É–∫—Ç—É—Ä–∞:  
   ```text
   ["time", "open", "high", "low", "close", "volume"]
   ```
2. **JSON-–æ—Ç—á—ë—Ç Prefect**
   ```json
   {
     "context_id": "run-002",
     "status": "SUCCESS",
     "rows": 28800,
     "path": "/data/archive/raw/GER40/M15/2025_04_01_2025_05_31.parquet",
     "integrity": "ok"
   }
   ```

3. **–õ–æ–≥-—Ñ–∞–π–ª:** `/logs/coredata/archive_loader.log`

---

## 6. üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã.  
–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π  
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ SetupManager (—á–µ—Ä–µ–∑ DataEngine).  
2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏:
   `/data/archive/raw/{symbol}/{timeframe}/`
3. –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ `.parquet` –∏ `.csv`.  
4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç.  
5. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ ‚Üí `pandas.DataFrame`.  
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `data_integrity_checker`.  
7. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ (UTC).  
8. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.  
9. –í–æ–∑–≤—Ä–∞—Ç DataFrame –∏ –æ—Ç—á—ë—Ç–∞ Prefect.

–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö  
- –ï—Å–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ñ–∞–π–ª–æ–≤ –Ω–µ—Ç ‚Üí raise FileNotFoundError.
- –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω ‚Üí raise ValueError.
- –ï—Å–ª–∏ Integrity Check –Ω–µ –ø—Ä–æ–π–¥–µ–Ω ‚Üí raise DataIntegrityError.
- –ï—Å–ª–∏ –∫—ç—à –∞–∫—Ç–∏–≤–µ–Ω, –Ω–æ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω ‚Üí –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∫—ç—à–∞.
---


## 7. –ü—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
–ü—Ä–æ–≤–µ—Ä–∫–∞	   –ú–µ—Ç–æ–¥	          –û–ø–∏—Å–∞–Ω–∏–µ
–ù–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤	Path.glob()	–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∞—Ä—Ö–∏–≤–æ–≤
–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞	path.suffix	–¢–æ–ª—å–∫–æ .csv –∏ .parquet
–°—Ç—Ä—É–∫—Ç—É—Ä–∞	DataFrame.columns	–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
UTC-–≤—Ä–µ–º—è	tz_localize('UTC')	–ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –µ–¥–∏–Ω–æ–π –∑–æ–Ω–µ
–ü—Ä–æ–ø—É—Å–∫–∏/NaN	df.isnull().sum()	–û—à–∏–±–∫–∏ ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
–î—É–±–ª–∏–∫–∞—Ç—ã	df.duplicated()	–£–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞	df.sort_values("time")	–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å	data_integrity_checker	–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

## 8. üß† –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–¥–º–æ–¥—É–ª—è–º–∏
–ú–æ–¥—É–ª—å	–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ	–§–æ—Ä–º–∞—Ç
MT5 Connector (2.2.1)	fallback	JSON report + DataFrame
Data Processor (2.2.3)	output ‚Üí input	DataFrame
Data Validator (2.2.6)	output ‚Üí input	DataFrame
Data Engine (2.2.8)	—É–ø—Ä–∞–≤–ª—è—é—â–∏–π	Task call (Prefect)
Prefect FlowController	orchestration	Prefect @task

## 9. üß© –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥–º–æ–¥—É–ª–∏
9.1 archive_file_resolver.py

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞—Ä—Ö–∏–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ –¥–∞—Ç–µ.
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ–¥–º–æ–¥—É–ª—å 2.2.2.1 Archive File Resolver,
–∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç:

def find_files(symbol: str, timeframe: str, start: str, end: str) -> list[Path]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ .csv/.parquet, –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏—Ö –¥–∏–∞–ø–∞–∑–æ–Ω."""


–†–µ–∑—É–ª—å—Ç–∞—Ç: —É–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –∏ –ø–æ–≤—ã—à–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤.

9.2 data_cache_manager.py (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

–ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∏–∑ MT5Connector (—Ä–∞–∑–¥–µ–ª 5.2 ITA_TZ_02.2.1).
–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TTL.

## 10. üßæ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ  

–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ (loguru):

[ARCHIVE] - –ø–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤
[LOAD] - –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
[MERGE] - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
[CHECK] - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
[CACHE] - –∑–∞–ø–∏—Å—å –≤ –∫–µ—à
[PREFECT] - —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏


–ü—É—Ç—å –ª–æ–≥–æ–≤:

/logs/coredata/archive_loader.log


–ü—Ä–∏–º–µ—Ä:

2025-11-11 10:21:33 | INFO | [ARCHIVE] –ù–∞–π–¥–µ–Ω–æ 3 —Ñ–∞–π–ª–∞ –¥–ª—è GER40 M15
2025-11-11 10:21:35 | INFO | [MERGE] –û–±—ä–µ–¥–∏–Ω–µ–Ω–æ 28800 —Å—Ç—Ä–æ–∫
2025-11-11 10:21:37 | INFO | [CHECK] Integrity OK
2025-11-11 10:21:38 | SUCCESS | [DONE] CSV Loader –∑–∞–≤–µ—Ä—à–∏–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

11. ‚öôÔ∏è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Prefect Task
from prefect import task
from coredata.data_integrity_checker import data_integrity_check
import pandas as pd
from pathlib import Path
from loguru import logger
import json

@task(name="CSVArchiveLoaderTask")
def run_csv_loader(ctx):
    symbol = ctx["symbol"]
    timeframe = ctx["timeframe"]
    start = pd.Timestamp(ctx["date_start"], tz="UTC")
    end = pd.Timestamp(ctx["date_end"], tz="UTC")
    run_id = ctx.get("prefect_context_id", f"run-{pd.Timestamp.now():%Y%m%d%H%M%S}")

    try:
        base_path = Path(f"data/archive/raw/{symbol}/{timeframe}/")
        files = sorted(base_path.glob("*.parquet")) + sorted(base_path.glob("*.csv"))
        if not files:
            raise FileNotFoundError(f"No archive files found for {symbol} {timeframe}")

        dfs = []
        for f in files:
            if f.suffix == ".parquet":
                df = pd.read_parquet(f)
            elif f.suffix == ".csv":
                df = pd.read_csv(f)
            else:
                continue
            dfs.append(df)

        full_df = pd.concat(dfs, ignore_index=True)
        full_df["time"] = pd.to_datetime(full_df["time"], utc=True)
        full_df.sort_values("time", inplace=True)

        integrity_ok = data_integrity_check(full_df, symbol, timeframe)
        if not integrity_ok:
            raise ValueError("Integrity check failed")

        out_path = Path(f"data/cache/{symbol}_{timeframe}_merged.parquet")
        full_df.to_parquet(out_path)

        result = {
            "context_id": run_id,
            "status": "SUCCESS",
            "rows": len(full_df),
            "path": str(out_path),
            "integrity": "ok"
        }
        json.dump(result, open(f"logs/coredata/{run_id}_csvloader.json", "w"), indent=2)
        logger.success(f"[DONE] CSV Loader –∑–∞–≤–µ—Ä—à–∏–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: {symbol} {timeframe}")
        return result

    except Exception as e:
        logger.exception(f"[ERROR] {e}")
        return {"context_id": run_id, "status": "FAILED", "error": str(e)}
## 12. ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ö—Ä–∏—Ç–µ—Ä–∏–π | –ü—Ä–æ–≤–µ—Ä–∫–∞ |
|----------|-----------|-----------|
| –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ | ‚â§ 2 —Å–µ–∫ / 100 –ú–ë | Prefect logs |
| –£—Å–ø–µ—à–Ω–æ—Å—Ç—å Integrity Check | ‚â• 99% | Test report |
| –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ NaN / –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ | 100% | Data Validator |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–æ–≤ | –ø–æ–ª–Ω–∞—è | Data Engine tests |
| –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ITA_architecture_v1.1 | Review |

## 13. üìÑ –í—ã—Ö–æ–¥–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
–ê—Ä—Ç–µ—Ñ–∞–∫—Ç	–§–æ—Ä–º–∞—Ç	–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
archive_loader.py	Python	–æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ–¥–º–æ–¥—É–ª—å
archive_file_resolver.py	Python	–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π
logs/coredata/archive_loader.log	log	–∂—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π
cache/{symbol}_{tf}_merged.parquet	Parquet	—Å–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
{run_id}_csvloader.json	JSON	–æ—Ç—á—ë—Ç Prefect

## 14. ‚ö†Ô∏è –û—à–∏–±–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
–û—à–∏–±–∫–∞	–ü—Ä–∏—á–∏–Ω–∞	–î–µ–π—Å—Ç–≤–∏–µ
FileNotFoundError	–ù–µ—Ç –∞—Ä—Ö–∏–≤–æ–≤	–í–æ–∑–≤—Ä–∞—Ç FAILED, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
ValueError	–ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–π —Ñ–∞–π–ª	–ò—Å–∫–ª—é—á–µ–Ω–∏–µ + –ª–æ–≥
IntegrityError	–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞	–ò—Å–∫–ª—é—á–µ–Ω–∏–µ
IOError	–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏	–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
PrefectError	–û—à–∏–±–∫–∞ —Ç–∞—Å–∫–∞	JSON-–æ—Ç—á—ë—Ç FAILED

## 15. üß≠ –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- –ú–æ–¥—É–ª—å –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç MT5 API.
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ off-line —Ä–µ–∂–∏–º–µ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏ –ø–æ–ª—è, —á—Ç–æ –∏ MT5Connector.
- –°–æ–≤–º–µ—Å—Ç–∏–º —Å Windows/Linux.
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–∏ Backtest –∏ fallback Live.
- –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –ø—É—Ç–µ–π.
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π) —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

## 16. üìö –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ   

–§–∞–π–ª: tests/test_csv_archive_loader.py

- –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞—Ä—Ö–∏–≤–æ–≤.
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤.
- –°—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ MT5.
- –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ Integrity Check.
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç—á—ë—Ç–∞ Prefect.
---
---
## –î–æ–ø–æ–ª–Ω–µ–Ω–∏—è:
–ï—Å–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö –¥–∞—Ç —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–∫—Ä—ã—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∞—Ä—Ö–∏–≤–æ–º,
archive_loader –≤—ã—á–∏—Å–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —É—á–∞—Å—Ç–∫–∏ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç MT5Connector.run_mt5_ingest()
—Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–∏—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤. –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è merge –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞—Ä—Ö–∏–≤–∞.

üìê –ê–ª–≥–æ—Ä–∏—Ç–º –º–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å —Ç–∞–∫:

if requested_range ‚äÇ existing_range:
    return archive
elif requested_range ‚à© existing_range ‚â† ‚àÖ:
    load missing part from MT5Connector
    merge and resave archive
else:
    full fetch from MT5Connector

**–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ Prefect Dashboard:**

üü¢ –ê—Ä—Ö–∏–≤ –Ω–∞–π–¥–µ–Ω
üü† –î–æ–∑–∞–≥—Ä—É–∑–∫–∞
üîµ –ó–∞–≥—Ä—É–∑–∫–∞ —Å MT5
üî¥ –û—à–∏–±–∫–∞
---

## ‚úÖ –ò—Ç–æ–≥

–ü–æ–¥–º–æ–¥—É–ª—å **2.2.2 CSV / Archive Loader** ‚Äî —ç—Ç–æ **–Ω–∞–¥–µ–∂–Ω—ã–π –æ—Ñ—Ñ–ª–∞–π–Ω-–∑–∞–≥—Ä—É–∑—á–∏–∫ –¥–∞–Ω–Ω—ã—Ö**,  
–≤—ã–ø–æ–ª–Ω—è—é—â–∏–π —Ä–æ–ª—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è Backtest.  
–û–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å MT5Connector, Prefect Flow, Data Processor –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π ITA.  

–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:  
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è offline-–∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
- –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã DataFrame.
- –ü–æ–≤—ã—à–µ–Ω–∏–µ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã CoreData.


**–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä:** GPT-5 (ITA Docs Full Analysis Mode)  
**–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:** Dreyk  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.1 (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è)
