–ü–æ–¥–º–æ–¥—É–ª—å M02.3_ArchiveDataLoader

–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –¢–ó:

–ï—Å–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö –¥–∞—Ç —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–∫—Ä—ã—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∞—Ä—Ö–∏–≤–æ–º,
archive_loader –≤—ã—á–∏—Å–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —É—á–∞—Å—Ç–∫–∏ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç MT5Connector.run_mt5_ingest()
—Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–∏—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤. –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è merge –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞—Ä—Ö–∏–≤–∞.

üìê –ê–ª–≥–æ—Ä–∏—Ç–º –º–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å —Ç–∞–∫:

if requested_range ‚äÇ existing_range:
    return archive
elif requested_range ‚à© existing_range ‚â† ‚àÖ:
    load missing part from MT5Connector
    merge and resave archive
else:
    full fetch from MT5Connector

üîπ –ü–æ–≤–µ–¥–µ–Ω–∏–µ
–°—Ü–µ–Ω–∞—Ä–∏–π	–î–µ–π—Å—Ç–≤–∏–µ	–†–µ–∑—É–ª—å—Ç–∞—Ç
–ê—Ä—Ö–∏–≤ –Ω–∞–π–¥–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é	–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç status="ARCHIVED"	–≠–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã
–ê—Ä—Ö–∏–≤ –Ω–∞–π–¥–µ–Ω —á–∞—Å—Ç–∏—á–Ω–æ	–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω –≤ MT5Connector	–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∑–∞–≥—Ä—É–∑–∫–∞
–ê—Ä—Ö–∏–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω	–ó–∞–ø—É—Å–∫ MT5Connector	–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π .parquet
–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏	–í–æ–∑–≤—Ä–∞—Ç status="FAILED"	–õ–æ–≥ –≤ logs/coredata
üîπ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞–π–ø–ª–∞–π–Ω–æ–º

–ù–∞ –≥—Ä–∞—Ñ–∏–∫–µ Pipeline –ø–æ–∑–∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç—É—é –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é:

üü¢ ¬´–ê—Ä—Ö–∏–≤ –Ω–∞–π–¥–µ–Ω¬ª

üü† ¬´–î–æ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö‚Ä¶¬ª

üîµ ¬´–ü–æ–ª—É—á–µ–Ω–æ —Å MT5Connector¬ª

üî¥ ¬´–û—à–∏–±–∫–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å MT5¬ª

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ —Ç–∞—Å–∫–µ Prefect:

@task(name="ArchiveLoaderTask", log_prints=True)
def load_or_request_data(ctx):
    ...
    prefect.context.get_run_logger().info("[ARCHIVE] –î–∞–Ω–Ω—ã–µ –Ω–∞–π–¥–µ–Ω—ã ‚Äî ARCHIVED")


–≠—Ç–æ –¥–∞—Å—Ç –Ω–∞–º –∫—Ä–∞—Å–∏–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –≤ Prefect UI –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –æ–±–æ–ª–æ—á–∫–∏.

------------------------

mt5_connector.py –∫–æ–¥:
–ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç / –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ

–ù–µ—Ç TTL –∏ –ø–æ–ª–∏—Ç–∏–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, auto-delete —Å—Ç–∞—Ä—à–µ 1 —á–∞—Å–∞).
–ù–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (–¥–ª—è Backtest).
–ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å–ª–æ—è –∫–µ—à–∞ ‚Äî CACHE_DIR –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ mt5_connector.py.
–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Å CSV/Archive Loader ‚Äî —Å–µ–π—á–∞—Å –æ–Ω–∏ –±—É–¥—É—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.
–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ "—Ñ–∞–π–ª–æ–≤—ã—Ö –∫–ª—é—á–µ–π", —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞—Ä—Ö–∏–≤ –Ω—É–∂–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω.

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–µ–∑ –ø—Ä–∞–≤–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞, –∏—Å–ø–æ–ª—å–∑—É—è –æ–±—ë—Ä—Ç–∫—É –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ —Ä–∞–º–∫–∞—Ö –ø–æ–¥–º–æ–¥—É–ª–µ–π archive_loader –∏ data_cache_manager.
–ú—ã –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é:  

from M02_CoreData.mt5_connector import run_mt5_ingest  

–∏ –≤—Å—ë –ø–æ–≤–µ–¥–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–µ–º, –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤, –∏ fallback –ª–æ–≥–∏–∫–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º –≤ —Å–ª–æ–∏ –≤–æ–∫—Ä—É–≥ –Ω–µ—ë:
archive_file_resolver.py (–∏—â–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∞—Ä—Ö–∏–≤—ã);
data_cache_manager.py (—É–ø—Ä–∞–≤–ª—è–µ—Ç –∫—ç—à–µ–º –∏ TTL);
archive_loader.py (–æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å—ë –∏ —Ä–µ—à–∞–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –∑–≤–∞—Ç—å MT5Connector).  

üìò –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:  
mt5_connector –æ—Å—Ç–∞—ë—Ç—Å—è —á–∏—Å—Ç—ã–º –∏ –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º ‚Äî —ç—Ç–æ ‚Äú–¥–≤–∏–≥–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∑–∫–∏‚Äù.
archive_loader + –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥–º–æ–¥—É–ª–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —É–ø—Ä–∞–≤–ª—è—é—â–∏–º –∫–æ–Ω—Ç—É—Ä–æ–º (Data Orchestrator Layer).
TTL, –∫–µ—à, –∞—Ä—Ö–∏–≤—ã –∏ —É—Å–ª–æ–≤–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ ‚Äî –≤—Å—ë —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è ‚Äú—Å–Ω–∞—Ä—É–∂–∏‚Äù.

---
data_integrity_checker —É–∂–µ –º–æ–∂–Ω–æ –∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ –≤—Å–µ—Ö –ø–æ–¥–º–æ–¥—É–ª—è—Ö CoreData.
–û–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º —à–∞–≥–æ–º –ø–µ—Ä–µ–¥ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –¥–∞–Ω–Ω—ã—Ö –≤ Data Processor.

---
–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π: –∫—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –∏ –∫–µ—à

–ß—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –±—ã–ª–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ–π, –≤–∞–∂–Ω–æ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏:

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç	–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å	–¢–∏–ø –∑–∞–¥–∞—á
SetupManager	–ø–µ—Ä–µ–¥–∞—ë—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (symbol, timeframe, mode, refresh_interval)	–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
Data Refresh Scheduler (2.2.4.1)	–∑–∞–¥–∞—ë—Ç –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö (Live Refresh –∫–∞–∂–¥—ã–µ N —Å–µ–∫/–º–∏–Ω)	–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
MT5 Connector (2.2.1)	–≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ MT5 (–ø–æ –∫–æ–º–∞–Ω–¥–µ)	–ó–∞–≥—Ä—É–∑–∫–∞
Data Cache Manager (2.2.2.2)	—É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–µ—à–µ–º: TTL, –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤, –æ—á–∏—Å—Ç–∫–∞	–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
Archive Loader (2.2.2)	–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑ –∞—Ä—Ö–∏–≤–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç DF, –µ—Å–ª–∏ MT5 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω	Fallback
Data Processor (2.2.3)	–Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ	–û–±—Ä–∞–±–æ—Ç–∫–∞

üîπ –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:

–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ (refresh) —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Scheduler‚Äô–æ–º (2.2.4.1),
–∞ –Ω–µ —Å–∞–º–∏–º MT5 Connector –∏–ª–∏ CSV Loader.

–ö—ç—à –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ TTL –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç—Å—è Data Cache Manager (2.2.2.2).

üíæ 3. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å (CoreData —ç—Ç–∞–ø 2)
‚úÖ –ó–∞–¥–∞—á–∏ –ø–æ –¥–æ—Ä–∞–±–æ—Ç–∫–µ —Å–∏—Å—Ç–µ–º—ã –∫–µ—à–∞:
(1) –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª src/M02_CoreData/data_cache_manager.py

–≠—Ç–æ—Ç –ø–æ–¥–º–æ–¥—É–ª—å –æ–±—ä–µ–¥–∏–Ω–∏—Ç –ª–æ–≥–∏–∫—É –∏–∑ mt5_connector –∏ –¥–æ–±–∞–≤–∏—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å TTL –∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤.

üìò –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
from pathlib import Path
import pandas as pd
import json
import time
from datetime import datetime, timedelta
from loguru import logger

CACHE_DIR = Path("data/cache")
CACHE_META = CACHE_DIR / "cache_index.json"

def save_cache(df: pd.DataFrame, symbol: str, timeframe: str, mode: str) -> Path:
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç DataFrame –≤ –∫—ç—à —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏."""
    ts = datetime.utcnow().strftime("%Y%m%d%H%M%S")
    path = CACHE_DIR / f"{symbol}_{timeframe}_{mode.lower()}_{ts}.parquet"
    CACHE_DIR.mkdir(parents=True, exist_ok=True)
    df.to_parquet(path)
    _update_cache_index(symbol, timeframe, mode, path)
    return path

def _update_cache_index(symbol, timeframe, mode, path):
    meta = {
        "symbol": symbol,
        "timeframe": timeframe,
        "mode": mode,
        "path": str(path),
        "timestamp": datetime.utcnow().isoformat()
    }
    CACHE_META.touch(exist_ok=True)
    with open(CACHE_META, "a") as f:
        json.dump(meta, f)
        f.write("\n")

def cleanup_cache(ttl_hours: int = 1):
    """–£–¥–∞–ª—è–µ—Ç –∫—ç—à —Å—Ç–∞—Ä—à–µ TTL."""
    cutoff = datetime.utcnow() - timedelta(hours=ttl_hours)
    for f in CACHE_DIR.glob("*.parquet"):
        if datetime.utcfromtimestamp(f.stat().st_mtime) < cutoff:
            logger.info(f"[CACHE] –£–¥–∞–ª—ë–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ñ–∞–π–ª {f.name}")
            f.unlink(missing_ok=True)

def is_range_cached(symbol: str, timeframe: str, start: datetime, end: datetime) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –∫—ç—à, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω."""
    # TODO: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–æ—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º
    return False

(2) –ü–æ–¥–∫–ª—é—á–∏—Ç—å data_cache_manager –∫ mt5_connector –∏ archive_loader

mt5_connector:

–∑–∞–º–µ–Ω–∏—Ç—å save_parquet() ‚Üí data_cache_manager.save_cache()

–¥–æ–±–∞–≤–∏—Ç—å cleanup_cache(ttl_hours=1) –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Live.

archive_loader:

–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å is_range_cached() –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –∞—Ä—Ö–∏–≤–æ–≤, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É.

üìä 4. –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Live

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –±—É–¥–µ—Ç –≤—ã–Ω–µ—Å–µ–Ω–æ –≤ Data Refresh Scheduler (2.2.4.1), –∞ –Ω–µ –≤ MT5 Connector.
–≠—Ç–æ –ª–æ–≥–∏—á–Ω–æ: Scheduler –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å Prefect Flow.

‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç—ã

–í —Ñ–∞–π–ª–µ config.yaml (—É–∂–µ –µ—Å—Ç—å —Ä–∞–∑–¥–µ–ª coredata.refresh):

coredata:
  refresh:
    live_interval: 1m      # –∫–∞–∂–¥–∞—è –º–∏–Ω—É—Ç–∞
    backtest_manual: true

üìò –ü–æ–≤–µ–¥–µ–Ω–∏–µ

Scheduler –±—É–¥–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å run_mt5_ingest() –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫.

MT5Connector –Ω–µ —Å–ª–µ–¥–∏—Ç —Å–∞–º –∑–∞ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å—é.

Cache –æ—á–∏—â–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ —á–∞—Å —á–µ—Ä–µ–∑ data_cache_manager.cleanup_cache() (TTL = 1h).

üìå 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –¥–ª—è Backtest

–≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –ø–æ–¥–Ω—è–ª ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ.

–ü—Ä–∏–º–µ—Ä:

–∞—Ä—Ö–∏–≤ ‚Äú2025_01_01_2025_12_31.parquet‚Äù,
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –¥–∏–∞–ø–∞–∑–æ–Ω 2025-05-01 ‚Üí 2025-10-31.
‚Äî –∞—Ä—Ö–∏–≤ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –∑–Ω–∞—á–∏—Ç –∑–∞–≥—Ä—É–∑–∫–∞ MT5 –Ω–µ –Ω—É–∂–Ω–∞.

‚úÖ –î–ª—è —ç—Ç–æ–≥–æ archive_file_resolver.py (2.2.2.1) –¥–æ–ª–∂–µ–Ω:

–ø–∞—Ä—Å–∏—Ç—å –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, YYYY_MM_DD_YYYY_MM_DD.parquet);

–ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞;

–≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ª–∏–±–æ —Ç–æ—á–Ω—ã–π —Ñ–∞–π–ª, –ª–∏–±–æ —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏—Ö.

üß© 6. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å–≤—è–∑—å –≤ –ø–æ—Ç–æ–∫–µ
Prefect Scheduler
    ‚Üì
Data Refresh Scheduler (2.2.4.1)
    ‚Üì
MT5 Connector (2.2.1)
    ‚Üì
Data Cache Manager (2.2.2.2)
    ‚Üì
Data Processor (2.2.3)
    ‚Üì
Data Validator (2.2.6)

‚úÖ –í—ã–≤–æ–¥
–ü–æ–¥–º–æ–¥—É–ª—å	–°—Ç–∞—Ç—É—Å	–ó–∞–¥–∞—á–∏
mt5_connector.py	–ì–æ—Ç–æ–≤, —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è cache_manager	+ TTL + cache_index
data_integrity_checker.py	–ì–æ—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ	–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
data_cache_manager.py	—Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ–¥–º–æ–¥—É–ª—å 2.2.2.2	—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TTL, —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º, –∏–Ω–¥–µ–∫—Å–æ–º
archive_file_resolver.py	—Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–º–æ–¥—É–ª—å 2.2.2.1	—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞—Ä—Ö–∏–≤–æ–≤ –ø–æ –¥–∞—Ç–µ
Data Refresh Scheduler	–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è Live periodic tasks	–∫–æ–Ω—Ç—Ä–æ–ª—å Prefect
CSV/Archive Loader	–≥–æ—Ç–æ–≤, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å cache_manager	–ø—Ä–æ–≤–µ—Ä–∫–∞ is_range_cached()
----
**–î–æ–±–∞–≤–∏—Ç—å –≤ data_cache_manager.py:**

‚Äú–§—É–Ω–∫—Ü–∏—è cleanup_cache(ttl_hours=1) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å—Ç–∞—Ä—Ç–µ Live, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –±–µ–∑ —É—á–∞—Å—Ç–∏—è MT5Connector.‚Äù  

–ì–¥–µ —Ä–µ–∞–ª–∏–∑—É–µ–º TTL –∏ –∫–µ—à?	- –í –Ω–æ–≤–æ–º –º–æ–¥—É–ª–µ data_cache_manager.py  
–ö—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏?	- Data Refresh Scheduler (2.2.4.1)  